var usernameErr = (err) => {
  window.username = "Player";
  alert(err);
};

fetch("https://willard.fun/profile", {headers:{"Content-Type": "application/json; charset=UTF-8"}}).then(data => {
  data.json().then(json => {
    window.username = json.username;
  }).catch(usernameErr);
}).catch(usernameErr);
window.setMulti = () => {
  if(!world){alert("You need to be in a world!");return}
  let target = world.id;
  window.m = new WebSocket("wss://willard.fun/ws?target="+target);
};
setMulti();
window.msg = msg => {
  var obj = {
    type:"eval",
    data: `if(!document.body.querySelector("#msgPeople")){
window.msgPeople=document.createElement("div");
}
msgPeople.id = "msgPeople";
msgPeople.style = "position:absolute;top:0;left:0; background:#eee;border:1px solid black; padding:10px; color:black;";
msgPeople.innerHTML="<b>${window.username} said:</b> ${msg}<br> <button onclick='msgPeople.remove()'>Close</button>";
document.body.appendChild(msgPeople);`
  };
  if(window.m){
    m.send(JSON.stringify(obj));
  }
};

window.setBlock = (x,y,z,i) => {
  m.send(JSON.stringify({
    type: "setBlock",
    data: [x,y,z,i]
  }))
};

window.sleep = ms => {
  return new Promise((resolve, reject) => {
    setTimeout(resolve, ms)
  })
};

window.blockTxt = async (txt, block, bgBlock) => {
block = block || block === 0 ? block : blockIds.glowstone;
bgBlock = bgBlock || 0;
var chars = {
  A:[
      "11111",
      "1---1",
      "11111",
      "1---1",
      "1---1"
    ],
  B:[
      "1111 ",
      "1---1",
      "1111 ",
      "1---1",
      "1111 "
    ],
  C:[
      " 1111",
      "1",
      "1",
      "1",
      " 1111"
    ],
  D:[
      "1111 ",
      "1---1",
      "1---1",
      "1---1",
      "1111"
    ],
  E:[
      "11111",
      "1",
      "11111",
      "1",
      "11111"
    ],
  F:[
      "11111",
      "1",
      "11111",
      "1",
      "1"
    ],
  G:[
      "11111",
      "1",
      "1--11",
      "1---1",
      "11111"
    ],
  H:[
      "1---1",
      "1---1",
      "11111",
      "1---1",
      "1---1"
    ],
  I:[
      "111",
      "-1",
      "-1",
      "-1",
      "111"
    ],
  J:[
      "11111",
      "---1",
      "---1",
      "1--1",
      "1111"
    ],
  K:[
      "1---1",
      "1--1",
      "111",
      "1--1",
      "1---1"
    ],
  L:[
      "1",
      "1",
      "1",
      "1",
      "11111"
    ],
  M:[
      "11111",
      "1-1-1",
      "1-1-1",
      "1-1-1",
      "1-1-1"
    ],
  N:[
      "1---1",
      "11--1",
      "1-1-1",
      "1--11",
      "1---1"
    ],
  O:[
      "11111",
      "1---1",
      "1---1",
      "1---1",
      "11111"
    ],
  P:[
      '11111',
      "1---1",
      "11111",
      "1",
      "1"
    ],
  Q:[
      "11111",
      "1---1",
      "1---1",
      "1--11",
      "11111",
      "-----1"
    ],
  R:[
      "11111",
      "1---1",
      "11111",
      "1--1",
      "1---1"
    ],
  S:[
      "11111",
      "1",
      "11111",
      "----1",
      "11111"
    ],
  T:[
      "11111",
      "--1",
      "--1",
      "--1",
      "--1"
    ],
  U:[
      "1---1",
      "1---1",
      "1---1",
      "1---1",
      "11111"
    ],
  V:[
      "1---1",
      "1---1",
      "-1-1",
      "-1-1",
      "--1"
    ],
  W:[
      "1-1-1",
      "1-1-1",
      "1-1-1",
      "1-1-1",
      "11111"
    ],
  X:[
      "1---1",
      "-1-1",
      "--1",
      "-1-1",
      "1---1"
    ],
  Y:[
      "1---1",
      "-1-1",
      "--1",
      "--1",
      "--1"
    ],
  Z:[
      "11111",
      "---1",
      "--1",
      "-1",
      "11111"
    ],
  a:[
      "-111",
      "----1",
      "-1111",
      "1---1",
      "-1111"
    ],
  b:[
      "1",
      "1",
      "1111",
      "1---1",
      "1111"
    ],
  c:[
      "",
      "-1111",
      "1",
      "1",
      "-1111"
    ],
  d:[
      "----1",
      "----1",
      "-1111",
      "1---1",
      "-1111"
    ],
  e:[
      "-111",
      "1---1",
      "11111",
      "1",
      "-1111"
    ],
  f:[
      "--111",
      "-1",
      "11111",
      "-1",
      "-1"
    ],
  g:[
      "",
      "-111",
      "1---1",
      "-1111",
      "----1",
      "-111"
    ],
  h:[
      "1",
      "1",
      "1111",
      "1---1",
      "1---1"
    ],
  i:[
      "",
      "1",
      "",
      "1",
      "1"
    ],
  j:[
      "---1",
      "",
      "---1",
      "1--1",
      "-11"
    ],
  k:[
      "1",
      "1-1",
      "11",
      "1-1",
      "1--1"
    ],
  l:[
      "1",
      "1",
      "1",
      "1",
      "1"
    ],
  m:[
      "",
      "",
      "1111",
      "1-1-1",
      "1-1-1"
    ],
  n:[
      "",
      "1-11",
      "11--1",
      "1---1",
      "1---1"
    ],
  o:[
      "",
      "-111",
      "1---1",
      "1---1",
      "-111"
    ],
  p:[
      "",
      "1111",
      "1---1",
      "1111",
      "1"
    ],
  q:[
      "",
      "-1111",
      "1---1",
      "-1111",
      "----1"
    ],
  r:[
      "",
      "",
      "1-111",
      "11",
      "1"
    ],
  s:[
      "-111",
      "1",
      "-111",
      "----1",
      "-111"
    ],
  t:[
      "",
      "-1",
      "111",
      "-1",
      "-11"
    ],
  u:[
      "",
      "",
      "1---1",
      "1---1",
      "-1111"
    ],
  v:[
      "",
      "",
      "1---1",
      "-1-1",
      "--1"
    ],
  w:[
      "",
      "",
      "1-1-1",
      "1-1-1",
      "-1-1"
    ],
  x:[
      "",
      "",
      "1--1",
      "-11",
      "1--1"
    ],
  y:[
      "",
      "1---1",
      "-1-1",
      "--1",
      "11-"
    ],
  z:[
      "",
      "1111",
      "--1",
      "-1",
      "1111"
    ],
  1:[
      "-11",
      "1-1",
      "--1",
      "--1",
      "11111"
    ],
  2:[
      "1111",
      "----1",
      "--11",
      "-1",
      "11111"
    ],
  3:[
      "1111",
      "----1",
      "1111",
      "----1",
      "1111"
    ],
  4:[
      "1--1",
      "1--1",
      "11111",
      "---1",
      "---1"
    ],
  5:[
      "11111",
      "1",
      "1111",
      "----1",
      "1111"
    ],
  6:[
      "-111",
      "1",
      "1111 ",
      "1---1",
      "-111"
    ],
  7:[
      "11111",
      "---1",
      "--1",
      "-1",
      "1"
    ],
  8:[
      "-111",
      "1---1",
      "-111",
      "1---1",
      "-111"
    ],
  9:[
      "-111",
      "1---1",
      "-1111",
      "----1",
      "-111"
    ],
  0:[
      "-111",
      "1---1",
      "1---1",
      "1---1",
      "-111"
    ],
  "~":[
        "-1-1",
        "1-1"
      ],
  "`":[
      "1",
      "-1"
      ],
  "!":[
        "1",
        "1",
        "1",
        "",
        "1"
      ],
  "@":[
        "11111",
        "1---1",
        "1-111",
        "1-1-1",
        "11111"
      ],
  "#":[
        "-1-1",
        "11111",
        "-1-1",
        "11111",
        "-1-1"
      ],
  "$":[
        "11111",
        "1-1",
        "11111",
        "--1-1",
        "11111"
      ],
  "%":[
        "----1",
        "1--1",
        "--1",
        "-1--1",
        "1"
      ],
  "^":[
        "--1",
        "-1-1",
        "-1-1"
      ],
  "&":[
      "-1",
      "1-1",
      "-11-1",
      "1--1",
      "-11-1"
    ],
  "*":[
        "--1",
        "-111",
        "--1-",
        "-1-1",
      ],
  "(":[
        "--1",
        "-1",
        "-1",
        "-1",
        "--1"
      ],
  ")":[
        "--1",
        "---1",
        "---1",
        "---1",
        "--1"
      ],
  "-":[
        "",
        "",
        "111"
      ],
  "_":[
        "",
        "",
        "",
        "",
        "11111"
      ],
  "=":[
        "",
        "-111",
        "",
        "-111"
      ],
  "+":[
        "",
        "--1",
        "-111",
        "--1"
      ],
  "[":[
        "-11",
        "-1",
        "-1",
        "-1",
        "-11"
      ],
  "]":[
        "--11",
        "---1",
        "---1",
        "---1",
        "--11"
      ],
  "{":[
        "--11",
        "--1",
        "-1",
        "--1",
        "--11"
      ],
  "}":[
        "-11",
        "--1",
        "---1",
        "--1",
        "-11"
      ],
  "|":[
        "-1",
        "-1",
        "-1",
        "-1",
        "-1"
      ],
  ":":[
        "",
        "1",
        "",
        "1"
      ],
  ";":[
        "",
        "1",
        "",
        "1",
        "1"
      ],
  "'":[
        "--1",
        "--1"
      ],
  '"':[
        "-1-1",
        "-1-1"
      ],
  "<":[
        "--1",
        "-1",
        "1",
        "-1",
        "--1"
      ],
  ">":[
        "1",
        "-1",
        "--1",
        "-1",
        "1"
      ],
  ",":[
        "",
        "",
        "",
        "",
        "-1",
        "1",
      ],
  ".":[
        "",
        "",
        "",
        "",
        "1"
      ],
  "/":[
        "---1",
        "--1",
        "--1",
        "-1",
        "-1"
      ],
  "\\":[
        "-1",
        "--1",
        "--1",
        "---1",
        "---1"
      ],
  "?":[
        "-111",
        "1---1",
        "--11",
        "",
        "--1"
      ],
};
var charLens = {
  I:4,
  i:2,
  l:2,
  t:4,
  x:5,
  z:5,
  " ":3,
  "-":4,
  "!":2,
  ".":2,
  ",":3,
  "|":3,
  "<":4,
  ">":4,
  ":":2,
  ";":2,
};
  function char(c,cx,cy,cz,block,bgBlock){
    if(!chars[c]){return}
    c = chars[c];
    for(var y=0;y<c.length;y++){
      var row=c[y];
      for(var x=0;x<row.length;x++){
        if(row[x]==="1"){
          world.setBlock(cx+x, cy-y,cz,block);
        }else if(bgBlock){
          world.setBlock(cx+x, cy-y,cz,bgBlock);
        }
      }
    }
  }

  var x = 0, y = 0;
  for(var i=0; i<txt.length; i++){
    if(txt[i] === "\n"){
      x = 0;
      y -= 6;
    }else{
      char(txt[i], p2.x+x, p2.y+y,p2.z, block, bgBlock);
      x += charLens[txt[i]] || 6;
    }
    player.lastPlace = Date.now();
    sleep(1000);
  }
};