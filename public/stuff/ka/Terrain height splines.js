//jshint esnext: true
const splineData = {"offset":{"coordinate":"continents","points":[{"location":-1.1,"value":0.044,"derivative":0},{"location":-1.02,"value":-0.2222,"derivative":0},{"location":-0.51,"value":-0.2222,"derivative":0},{"location":-0.44,"value":-0.12,"derivative":0},{"location":-0.18,"value":-0.12,"derivative":0},{"location":-0.16,"value":{"coordinate":"erosion","points":[{"location":-0.85,"value":{"coordinate":"ridges","points":[{"location":-1,"value":-0.08880186,"derivative":0.38940096},{"location":1,"value":0.69000006,"derivative":0.38940096}]},"derivative":0},{"location":-0.7,"value":{"coordinate":"ridges","points":[{"location":-1,"value":-0.115760356,"derivative":0.37788022},{"location":1,"value":0.6400001,"derivative":0.37788022}]},"derivative":0},{"location":-0.4,"value":{"coordinate":"ridges","points":[{"location":-1,"value":-0.2222,"derivative":0},{"location":-0.75,"value":-0.2222,"derivative":0},{"location":-0.65,"value":0,"derivative":0},{"location":0.5954547,"value":2.9802322e-8,"derivative":0},{"location":0.6054547,"value":2.9802322e-8,"derivative":0.2534563},{"location":1,"value":0.100000024,"derivative":0.2534563}]},"derivative":0},{"location":-0.35,"value":{"coordinate":"ridges","points":[{"location":-1,"value":-0.3,"derivative":0.5},{"location":-0.4,"value":0.05,"derivative":0},{"location":0,"value":0.05,"derivative":0},{"location":0.4,"value":0.05,"derivative":0},{"location":1,"value":0.060000002,"derivative":0.007000001}]},"derivative":0},{"location":-0.1,"value":{"coordinate":"ridges","points":[{"location":-1,"value":-0.15,"derivative":0.5},{"location":-0.4,"value":0,"derivative":0},{"location":0,"value":0,"derivative":0},{"location":0.4,"value":0.05,"derivative":0.1},{"location":1,"value":0.060000002,"derivative":0.007000001}]},"derivative":0},{"location":0.2,"value":{"coordinate":"ridges","points":[{"location":-1,"value":-0.15,"derivative":0.5},{"location":-0.4,"value":0,"derivative":0},{"location":0,"value":0,"derivative":0},{"location":0.4,"value":0,"derivative":0},{"location":1,"value":0,"derivative":0}]},"derivative":0},{"location":0.7,"value":{"coordinate":"ridges","points":[{"location":-1,"value":-0.02,"derivative":0},{"location":-0.4,"value":-0.03,"derivative":0},{"location":0,"value":-0.03,"derivative":0},{"location":0.4,"value":0,"derivative":0.06},{"location":1,"value":0,"derivative":0}]},"derivative":0}]},"derivative":0},{"location":-0.15,"value":{"coordinate":"erosion","points":[{"location":-0.85,"value":{"coordinate":"ridges","points":[{"location":-1,"value":-0.08880186,"derivative":0.38940096},{"location":1,"value":0.69000006,"derivative":0.38940096}]},"derivative":0},{"location":-0.7,"value":{"coordinate":"ridges","points":[{"location":-1,"value":-0.115760356,"derivative":0.37788022},{"location":1,"value":0.6400001,"derivative":0.37788022}]},"derivative":0},{"location":-0.4,"value":{"coordinate":"ridges","points":[{"location":-1,"value":-0.2222,"derivative":0},{"location":-0.75,"value":-0.2222,"derivative":0},{"location":-0.65,"value":0,"derivative":0},{"location":0.5954547,"value":2.9802322e-8,"derivative":0},{"location":0.6054547,"value":2.9802322e-8,"derivative":0.2534563},{"location":1,"value":0.100000024,"derivative":0.2534563}]},"derivative":0},{"location":-0.35,"value":{"coordinate":"ridges","points":[{"location":-1,"value":-0.3,"derivative":0.5},{"location":-0.4,"value":0.05,"derivative":0},{"location":0,"value":0.05,"derivative":0},{"location":0.4,"value":0.05,"derivative":0},{"location":1,"value":0.060000002,"derivative":0.007000001}]},"derivative":0},{"location":-0.1,"value":{"coordinate":"ridges","points":[{"location":-1,"value":-0.15,"derivative":0.5},{"location":-0.4,"value":0,"derivative":0},{"location":0,"value":0,"derivative":0},{"location":0.4,"value":0.05,"derivative":0.1},{"location":1,"value":0.060000002,"derivative":0.007000001}]},"derivative":0},{"location":0.2,"value":{"coordinate":"ridges","points":[{"location":-1,"value":-0.15,"derivative":0.5},{"location":-0.4,"value":0,"derivative":0},{"location":0,"value":0,"derivative":0},{"location":0.4,"value":0,"derivative":0},{"location":1,"value":0,"derivative":0}]},"derivative":0},{"location":0.7,"value":{"coordinate":"ridges","points":[{"location":-1,"value":-0.02,"derivative":0},{"location":-0.4,"value":-0.03,"derivative":0},{"location":0,"value":-0.03,"derivative":0},{"location":0.4,"value":0,"derivative":0.06},{"location":1,"value":0,"derivative":0}]},"derivative":0}]},"derivative":0},{"location":-0.1,"value":{"coordinate":"erosion","points":[{"location":-0.85,"value":{"coordinate":"ridges","points":[{"location":-1,"value":-0.08880186,"derivative":0.38940096},{"location":1,"value":0.69000006,"derivative":0.38940096}]},"derivative":0},{"location":-0.7,"value":{"coordinate":"ridges","points":[{"location":-1,"value":-0.115760356,"derivative":0.37788022},{"location":1,"value":0.6400001,"derivative":0.37788022}]},"derivative":0},{"location":-0.4,"value":{"coordinate":"ridges","points":[{"location":-1,"value":-0.2222,"derivative":0},{"location":-0.75,"value":-0.2222,"derivative":0},{"location":-0.65,"value":0,"derivative":0},{"location":0.5954547,"value":2.9802322e-8,"derivative":0},{"location":0.6054547,"value":2.9802322e-8,"derivative":0.2534563},{"location":1,"value":0.100000024,"derivative":0.2534563}]},"derivative":0},{"location":-0.35,"value":{"coordinate":"ridges","points":[{"location":-1,"value":-0.25,"derivative":0.5},{"location":-0.4,"value":0.05,"derivative":0},{"location":0,"value":0.05,"derivative":0},{"location":0.4,"value":0.05,"derivative":0},{"location":1,"value":0.060000002,"derivative":0.007000001}]},"derivative":0},{"location":-0.1,"value":{"coordinate":"ridges","points":[{"location":-1,"value":-0.1,"derivative":0.5},{"location":-0.4,"value":0.001,"derivative":0.01},{"location":0,"value":0.003,"derivative":0.01},{"location":0.4,"value":0.05,"derivative":0.094000004},{"location":1,"value":0.060000002,"derivative":0.007000001}]},"derivative":0},{"location":0.2,"value":{"coordinate":"ridges","points":[{"location":-1,"value":-0.1,"derivative":0.5},{"location":-0.4,"value":0.01,"derivative":0},{"location":0,"value":0.01,"derivative":0},{"location":0.4,"value":0.03,"derivative":0.04},{"location":1,"value":0.1,"derivative":0.049}]},"derivative":0},{"location":0.7,"value":{"coordinate":"ridges","points":[{"location":-1,"value":-0.02,"derivative":0},{"location":-0.4,"value":-0.03,"derivative":0},{"location":0,"value":-0.03,"derivative":0},{"location":0.4,"value":0.03,"derivative":0.12},{"location":1,"value":0.1,"derivative":0.049}]},"derivative":0}]},"derivative":0},{"location":0.25,"value":{"coordinate":"erosion","points":[{"location":-0.85,"value":{"coordinate":"ridges","points":[{"location":-1,"value":0.20235021,"derivative":0},{"location":0,"value":0.7161751,"derivative":0.5138249},{"location":1,"value":1.23,"derivative":0.5138249}]},"derivative":0},{"location":-0.7,"value":{"coordinate":"ridges","points":[{"location":-1,"value":0.2,"derivative":0},{"location":0,"value":0.44682026,"derivative":0.43317974},{"location":1,"value":0.88,"derivative":0.43317974}]},"derivative":0},{"location":-0.4,"value":{"coordinate":"ridges","points":[{"location":-1,"value":0.2,"derivative":0},{"location":0,"value":0.30829495,"derivative":0.3917051},{"location":1,"value":0.70000005,"derivative":0.3917051}]},"derivative":0},{"location":-0.35,"value":{"coordinate":"ridges","points":[{"location":-1,"value":-0.25,"derivative":0.5},{"location":-0.4,"value":0.35,"derivative":0},{"location":0,"value":0.35,"derivative":0},{"location":0.4,"value":0.35,"derivative":0},{"location":1,"value":0.42000002,"derivative":0.049000014}]},"derivative":0},{"location":-0.1,"value":{"coordinate":"ridges","points":[{"location":-1,"value":-0.1,"derivative":0.5},{"location":-0.4,"value":0.0069999998,"derivative":0.07},{"location":0,"value":0.021,"derivative":0.07},{"location":0.4,"value":0.35,"derivative":0.658},{"location":1,"value":0.42000002,"derivative":0.049000014}]},"derivative":0},{"location":0.2,"value":{"coordinate":"ridges","points":[{"location":-1,"value":-0.1,"derivative":0.5},{"location":-0.4,"value":0.01,"derivative":0},{"location":0,"value":0.01,"derivative":0},{"location":0.4,"value":0.03,"derivative":0.04},{"location":1,"value":0.1,"derivative":0.049}]},"derivative":0},{"location":0.4,"value":{"coordinate":"ridges","points":[{"location":-1,"value":-0.1,"derivative":0.5},{"location":-0.4,"value":0.01,"derivative":0},{"location":0,"value":0.01,"derivative":0},{"location":0.4,"value":0.03,"derivative":0.04},{"location":1,"value":0.1,"derivative":0.049}]},"derivative":0},{"location":0.45,"value":{"coordinate":"ridges","points":[{"location":-1,"value":-0.1,"derivative":0},{"location":-0.4,"value":{"coordinate":"ridges","points":[{"location":-1,"value":-0.1,"derivative":0.5},{"location":-0.4,"value":0.01,"derivative":0},{"location":0,"value":0.01,"derivative":0},{"location":0.4,"value":0.03,"derivative":0.04},{"location":1,"value":0.1,"derivative":0.049}]},"derivative":0},{"location":0,"value":0.17,"derivative":0}]},"derivative":0},{"location":0.55,"value":{"coordinate":"ridges","points":[{"location":-1,"value":-0.1,"derivative":0},{"location":-0.4,"value":{"coordinate":"ridges","points":[{"location":-1,"value":-0.1,"derivative":0.5},{"location":-0.4,"value":0.01,"derivative":0},{"location":0,"value":0.01,"derivative":0},{"location":0.4,"value":0.03,"derivative":0.04},{"location":1,"value":0.1,"derivative":0.049}]},"derivative":0},{"location":0,"value":0.17,"derivative":0}]},"derivative":0},{"location":0.58,"value":{"coordinate":"ridges","points":[{"location":-1,"value":-0.1,"derivative":0.5},{"location":-0.4,"value":0.01,"derivative":0},{"location":0,"value":0.01,"derivative":0},{"location":0.4,"value":0.03,"derivative":0.04},{"location":1,"value":0.1,"derivative":0.049}]},"derivative":0},{"location":0.7,"value":{"coordinate":"ridges","points":[{"location":-1,"value":-0.02,"derivative":0},{"location":-0.4,"value":-0.03,"derivative":0},{"location":0,"value":-0.03,"derivative":0},{"location":0.4,"value":0.03,"derivative":0.12},{"location":1,"value":0.1,"derivative":0.049}]},"derivative":0}]},"derivative":0},{"location":1,"value":{"coordinate":"erosion","points":[{"location":-0.85,"value":{"coordinate":"ridges","points":[{"location":-1,"value":0.34792626,"derivative":0},{"location":0,"value":0.9239631,"derivative":0.5760369},{"location":1,"value":1.5,"derivative":0.5760369}]},"derivative":0},{"location":-0.7,"value":{"coordinate":"ridges","points":[{"location":-1,"value":0.2,"derivative":0},{"location":0,"value":0.5391705,"derivative":0.4608295},{"location":1,"value":1,"derivative":0.4608295}]},"derivative":0},{"location":-0.4,"value":{"coordinate":"ridges","points":[{"location":-1,"value":0.2,"derivative":0},{"location":0,"value":0.5391705,"derivative":0.4608295},{"location":1,"value":1,"derivative":0.4608295}]},"derivative":0},{"location":-0.35,"value":{"coordinate":"ridges","points":[{"location":-1,"value":-0.2,"derivative":0.5},{"location":-0.4,"value":0.5,"derivative":0},{"location":0,"value":0.5,"derivative":0},{"location":0.4,"value":0.5,"derivative":0},{"location":1,"value":0.6,"derivative":0.070000015}]},"derivative":0},{"location":-0.1,"value":{"coordinate":"ridges","points":[{"location":-1,"value":-0.05,"derivative":0.5},{"location":-0.4,"value":0.01,"derivative":0.099999994},{"location":0,"value":0.03,"derivative":0.099999994},{"location":0.4,"value":0.5,"derivative":0.94},{"location":1,"value":0.6,"derivative":0.070000015}]},"derivative":0},{"location":0.2,"value":{"coordinate":"ridges","points":[{"location":-1,"value":-0.05,"derivative":0.5},{"location":-0.4,"value":0.01,"derivative":0},{"location":0,"value":0.01,"derivative":0},{"location":0.4,"value":0.03,"derivative":0.04},{"location":1,"value":0.1,"derivative":0.049}]},"derivative":0},{"location":0.4,"value":{"coordinate":"ridges","points":[{"location":-1,"value":-0.05,"derivative":0.5},{"location":-0.4,"value":0.01,"derivative":0},{"location":0,"value":0.01,"derivative":0},{"location":0.4,"value":0.03,"derivative":0.04},{"location":1,"value":0.1,"derivative":0.049}]},"derivative":0},{"location":0.45,"value":{"coordinate":"ridges","points":[{"location":-1,"value":-0.05,"derivative":0},{"location":-0.4,"value":{"coordinate":"ridges","points":[{"location":-1,"value":-0.05,"derivative":0.5},{"location":-0.4,"value":0.01,"derivative":0},{"location":0,"value":0.01,"derivative":0},{"location":0.4,"value":0.03,"derivative":0.04},{"location":1,"value":0.1,"derivative":0.049}]},"derivative":0},{"location":0,"value":0.17,"derivative":0}]},"derivative":0},{"location":0.55,"value":{"coordinate":"ridges","points":[{"location":-1,"value":-0.05,"derivative":0},{"location":-0.4,"value":{"coordinate":"ridges","points":[{"location":-1,"value":-0.05,"derivative":0.5},{"location":-0.4,"value":0.01,"derivative":0},{"location":0,"value":0.01,"derivative":0},{"location":0.4,"value":0.03,"derivative":0.04},{"location":1,"value":0.1,"derivative":0.049}]},"derivative":0},{"location":0,"value":0.17,"derivative":0}]},"derivative":0},{"location":0.58,"value":{"coordinate":"ridges","points":[{"location":-1,"value":-0.05,"derivative":0.5},{"location":-0.4,"value":0.01,"derivative":0},{"location":0,"value":0.01,"derivative":0},{"location":0.4,"value":0.03,"derivative":0.04},{"location":1,"value":0.1,"derivative":0.049}]},"derivative":0},{"location":0.7,"value":{"coordinate":"ridges","points":[{"location":-1,"value":-0.02,"derivative":0.015},{"location":-0.4,"value":0.01,"derivative":0},{"location":0,"value":0.01,"derivative":0},{"location":0.4,"value":0.03,"derivative":0.04},{"location":1,"value":0.1,"derivative":0.049}]},"derivative":0}]},"derivative":0}]},"factor":{"coordinate":"continents","points":[{"location":-0.19,"value":3.95,"derivative":0},{"location":-0.15,"value":{"coordinate":"erosion","points":[{"location":-0.6,"value":{"coordinate":"weirdness","points":[{"location":-0.2,"value":6.3,"derivative":0},{"location":0.2,"value":6.25,"derivative":0}]},"derivative":0},{"location":-0.5,"value":{"coordinate":"weirdness","points":[{"location":-0.05,"value":6.3,"derivative":0},{"location":0.05,"value":2.67,"derivative":0}]},"derivative":0},{"location":-0.35,"value":{"coordinate":"weirdness","points":[{"location":-0.2,"value":6.3,"derivative":0},{"location":0.2,"value":6.25,"derivative":0}]},"derivative":0},{"location":-0.25,"value":{"coordinate":"weirdness","points":[{"location":-0.2,"value":6.3,"derivative":0},{"location":0.2,"value":6.25,"derivative":0}]},"derivative":0},{"location":-0.1,"value":{"coordinate":"weirdness","points":[{"location":-0.05,"value":2.67,"derivative":0},{"location":0.05,"value":6.3,"derivative":0}]},"derivative":0},{"location":0.03,"value":{"coordinate":"weirdness","points":[{"location":-0.2,"value":6.3,"derivative":0},{"location":0.2,"value":6.25,"derivative":0}]},"derivative":0},{"location":0.35,"value":6.25,"derivative":0},{"location":0.45,"value":{"coordinate":"ridges","points":[{"location":-0.9,"value":6.25,"derivative":0},{"location":-0.69,"value":{"coordinate":"weirdness","points":[{"location":0,"value":6.25,"derivative":0},{"location":0.1,"value":0.625,"derivative":0}]},"derivative":0}]},"derivative":0},{"location":0.55,"value":{"coordinate":"ridges","points":[{"location":-0.9,"value":6.25,"derivative":0},{"location":-0.69,"value":{"coordinate":"weirdness","points":[{"location":0,"value":6.25,"derivative":0},{"location":0.1,"value":0.625,"derivative":0}]},"derivative":0}]},"derivative":0},{"location":0.62,"value":6.25,"derivative":0}]},"derivative":0},{"location":-0.1,"value":{"coordinate":"erosion","points":[{"location":-0.6,"value":{"coordinate":"weirdness","points":[{"location":-0.2,"value":6.3,"derivative":0},{"location":0.2,"value":5.47,"derivative":0}]},"derivative":0},{"location":-0.5,"value":{"coordinate":"weirdness","points":[{"location":-0.05,"value":6.3,"derivative":0},{"location":0.05,"value":2.67,"derivative":0}]},"derivative":0},{"location":-0.35,"value":{"coordinate":"weirdness","points":[{"location":-0.2,"value":6.3,"derivative":0},{"location":0.2,"value":5.47,"derivative":0}]},"derivative":0},{"location":-0.25,"value":{"coordinate":"weirdness","points":[{"location":-0.2,"value":6.3,"derivative":0},{"location":0.2,"value":5.47,"derivative":0}]},"derivative":0},{"location":-0.1,"value":{"coordinate":"weirdness","points":[{"location":-0.05,"value":2.67,"derivative":0},{"location":0.05,"value":6.3,"derivative":0}]},"derivative":0},{"location":0.03,"value":{"coordinate":"weirdness","points":[{"location":-0.2,"value":6.3,"derivative":0},{"location":0.2,"value":5.47,"derivative":0}]},"derivative":0},{"location":0.35,"value":5.47,"derivative":0},{"location":0.45,"value":{"coordinate":"ridges","points":[{"location":-0.9,"value":5.47,"derivative":0},{"location":-0.69,"value":{"coordinate":"weirdness","points":[{"location":0,"value":5.47,"derivative":0},{"location":0.1,"value":0.625,"derivative":0}]},"derivative":0}]},"derivative":0},{"location":0.55,"value":{"coordinate":"ridges","points":[{"location":-0.9,"value":5.47,"derivative":0},{"location":-0.69,"value":{"coordinate":"weirdness","points":[{"location":0,"value":5.47,"derivative":0},{"location":0.1,"value":0.625,"derivative":0}]},"derivative":0}]},"derivative":0},{"location":0.62,"value":5.47,"derivative":0}]},"derivative":0},{"location":0.03,"value":{"coordinate":"erosion","points":[{"location":-0.6,"value":{"coordinate":"weirdness","points":[{"location":-0.2,"value":6.3,"derivative":0},{"location":0.2,"value":5.08,"derivative":0}]},"derivative":0},{"location":-0.5,"value":{"coordinate":"weirdness","points":[{"location":-0.05,"value":6.3,"derivative":0},{"location":0.05,"value":2.67,"derivative":0}]},"derivative":0},{"location":-0.35,"value":{"coordinate":"weirdness","points":[{"location":-0.2,"value":6.3,"derivative":0},{"location":0.2,"value":5.08,"derivative":0}]},"derivative":0},{"location":-0.25,"value":{"coordinate":"weirdness","points":[{"location":-0.2,"value":6.3,"derivative":0},{"location":0.2,"value":5.08,"derivative":0}]},"derivative":0},{"location":-0.1,"value":{"coordinate":"weirdness","points":[{"location":-0.05,"value":2.67,"derivative":0},{"location":0.05,"value":6.3,"derivative":0}]},"derivative":0},{"location":0.03,"value":{"coordinate":"weirdness","points":[{"location":-0.2,"value":6.3,"derivative":0},{"location":0.2,"value":5.08,"derivative":0}]},"derivative":0},{"location":0.35,"value":5.08,"derivative":0},{"location":0.45,"value":{"coordinate":"ridges","points":[{"location":-0.9,"value":5.08,"derivative":0},{"location":-0.69,"value":{"coordinate":"weirdness","points":[{"location":0,"value":5.08,"derivative":0},{"location":0.1,"value":0.625,"derivative":0}]},"derivative":0}]},"derivative":0},{"location":0.55,"value":{"coordinate":"ridges","points":[{"location":-0.9,"value":5.08,"derivative":0},{"location":-0.69,"value":{"coordinate":"weirdness","points":[{"location":0,"value":5.08,"derivative":0},{"location":0.1,"value":0.625,"derivative":0}]},"derivative":0}]},"derivative":0},{"location":0.62,"value":5.08,"derivative":0}]},"derivative":0},{"location":0.06,"value":{"coordinate":"erosion","points":[{"location":-0.6,"value":{"coordinate":"weirdness","points":[{"location":-0.2,"value":6.3,"derivative":0},{"location":0.2,"value":4.69,"derivative":0}]},"derivative":0},{"location":-0.5,"value":{"coordinate":"weirdness","points":[{"location":-0.05,"value":6.3,"derivative":0},{"location":0.05,"value":2.67,"derivative":0}]},"derivative":0},{"location":-0.35,"value":{"coordinate":"weirdness","points":[{"location":-0.2,"value":6.3,"derivative":0},{"location":0.2,"value":4.69,"derivative":0}]},"derivative":0},{"location":-0.25,"value":{"coordinate":"weirdness","points":[{"location":-0.2,"value":6.3,"derivative":0},{"location":0.2,"value":4.69,"derivative":0}]},"derivative":0},{"location":-0.1,"value":{"coordinate":"weirdness","points":[{"location":-0.05,"value":2.67,"derivative":0},{"location":0.05,"value":6.3,"derivative":0}]},"derivative":0},{"location":0.03,"value":{"coordinate":"weirdness","points":[{"location":-0.2,"value":6.3,"derivative":0},{"location":0.2,"value":4.69,"derivative":0}]},"derivative":0},{"location":0.05,"value":{"coordinate":"ridges","points":[{"location":0.45,"value":{"coordinate":"weirdness","points":[{"location":-0.2,"value":6.3,"derivative":0},{"location":0.2,"value":4.69,"derivative":0}]},"derivative":0},{"location":0.7,"value":1.56,"derivative":0}]},"derivative":0},{"location":0.4,"value":{"coordinate":"ridges","points":[{"location":0.45,"value":{"coordinate":"weirdness","points":[{"location":-0.2,"value":6.3,"derivative":0},{"location":0.2,"value":4.69,"derivative":0}]},"derivative":0},{"location":0.7,"value":1.56,"derivative":0}]},"derivative":0},{"location":0.45,"value":{"coordinate":"ridges","points":[{"location":-0.7,"value":{"coordinate":"weirdness","points":[{"location":-0.2,"value":6.3,"derivative":0},{"location":0.2,"value":4.69,"derivative":0}]},"derivative":0},{"location":-0.15,"value":1.37,"derivative":0}]},"derivative":0},{"location":0.55,"value":{"coordinate":"ridges","points":[{"location":-0.7,"value":{"coordinate":"weirdness","points":[{"location":-0.2,"value":6.3,"derivative":0},{"location":0.2,"value":4.69,"derivative":0}]},"derivative":0},{"location":-0.15,"value":1.37,"derivative":0}]},"derivative":0},{"location":0.58,"value":4.69,"derivative":0}]},"derivative":0}]},"jaggedness":{"coordinate":"continents","points":[{"location":-0.11,"value":0,"derivative":0},{"location":0.03,"value":{"coordinate":"erosion","points":[{"location":-1,"value":{"coordinate":"ridges","points":[{"location":0.19999999,"value":0,"derivative":0},{"location":0.44999996,"value":0,"derivative":0},{"location":1,"value":{"coordinate":"weirdness","points":[{"location":-0.01,"value":0.63,"derivative":0},{"location":0.01,"value":0.3,"derivative":0}]},"derivative":0}]},"derivative":0},{"location":-0.78,"value":{"coordinate":"ridges","points":[{"location":0.19999999,"value":0,"derivative":0},{"location":0.44999996,"value":0,"derivative":0},{"location":1,"value":{"coordinate":"weirdness","points":[{"location":-0.01,"value":0.315,"derivative":0},{"location":0.01,"value":0.15,"derivative":0}]},"derivative":0}]},"derivative":0},{"location":-0.5775,"value":{"coordinate":"ridges","points":[{"location":0.19999999,"value":0,"derivative":0},{"location":0.44999996,"value":0,"derivative":0},{"location":1,"value":{"coordinate":"weirdness","points":[{"location":-0.01,"value":0.315,"derivative":0},{"location":0.01,"value":0.15,"derivative":0}]},"derivative":0}]},"derivative":0},{"location":-0.375,"value":0,"derivative":0}]},"derivative":0},{"location":0.65,"value":{"coordinate":"erosion","points":[{"location":-1,"value":{"coordinate":"ridges","points":[{"location":0.19999999,"value":0,"derivative":0},{"location":0.44999996,"value":{"coordinate":"weirdness","points":[{"location":-0.01,"value":0.63,"derivative":0},{"location":0.01,"value":0.3,"derivative":0}]},"derivative":0},{"location":1,"value":{"coordinate":"weirdness","points":[{"location":-0.01,"value":0.63,"derivative":0},{"location":0.01,"value":0.3,"derivative":0}]},"derivative":0}]},"derivative":0},{"location":-0.78,"value":{"coordinate":"ridges","points":[{"location":0.19999999,"value":0,"derivative":0},{"location":0.44999996,"value":0,"derivative":0},{"location":1,"value":{"coordinate":"weirdness","points":[{"location":-0.01,"value":0.63,"derivative":0},{"location":0.01,"value":0.3,"derivative":0}]},"derivative":0}]},"derivative":0},{"location":-0.5775,"value":{"coordinate":"ridges","points":[{"location":0.19999999,"value":0,"derivative":0},{"location":0.44999996,"value":0,"derivative":0},{"location":1,"value":{"coordinate":"weirdness","points":[{"location":-0.01,"value":0.63,"derivative":0},{"location":0.01,"value":0.3,"derivative":0}]},"derivative":0}]},"derivative":0},{"location":-0.375,"value":0,"derivative":0}]},"derivative":0}]}};
const loc = "location";

//let mins = {continents:Infinity,erosion:Infinity,ridges:Infinity,weirdness:Infinity}, maxs = {continents:-Infinity,erosion:-Infinity,ridges:-Infinity,weirdness:-Infinity};
function sortSplineLayer(o){
    o.points.sort(function(a,b){return a[loc]-b[loc];});
    for(let j=0; j<o.points.length; j++){
        const point = o.points[j];
        if(typeof point.value === "object"){
            sortSplineLayer(point.value);
        }
        /*else{
            mins[o.coordinate] = Math.min(mins[o.coordinate],o.points[i].value);
            maxs[o.coordinate] = Math.max(maxs[o.coordinate],o.points[i].value);
        }*/
    }
}
for(let i in splineData){
    sortSplineLayer(splineData[i]);
}

function lerp(t, a, b) {
    return a + t * (b - a);
}

function getSplineLayer(o,continents,erosion,ridges,weirdness){
    if(typeof o === "number"){return o;}
    let x;
    switch(o.coordinate){
        case "continents": x = continents; break;
        case "erosion": x = erosion; break;
        case "ridges": x = ridges; break;
        case "weirdness": x = weirdness; break;
    }
    const points = o.points;
    
    //binary search
    let n2 = points.length, n = 0;
    let n3 = n2;
	while (n3 > 0) {
		const n4 = Math.floor(n3 / 2);
		const n5 = n + n4;
		if (x < points[n5][loc]) {
			n3 = n4;
			continue;
		}
		n = n5 + 1;
		n3 -= n4 + 1;
	}
	
    //end binary search
	let idx = n-1;
    
    if(idx === points.length-1){
        const n = points.length-1;
        return getSplineLayer(points[n].value,continents,erosion,ridges,weirdness) + points[n].derivative * (x - points[n][loc]);
        //x=points[points.length-1][loc];
    }
    if(idx<0){
        return getSplineLayer(points[0].value,continents,erosion,ridges,weirdness) + points[0].derivative * (x - points[0][loc]);
        //x=points[0][loc];
    }
    
    const loc0 = points[idx][loc];
    const loc1 = points[idx+1][loc];
	const der0 = points[idx].derivative;
	const der1 = points[idx + 1].derivative;
	const f = (x - loc0) / (loc1 - loc0);

	const val0 = getSplineLayer(points[idx].value,continents,erosion,ridges,weirdness);
	const val1 = getSplineLayer(points[idx+1].value,continents,erosion,ridges,weirdness);
	const f8 = der0 * (loc1 - loc0) - (val1 - val0);
	const f9 = -der1 * (loc1 - loc0) + (val1 - val0);
	const f10 = lerp(f, val0, val1) + f * (1.0 - f) * lerp(f, f8, f9);
	return f10;
}

let sliders = [];
//slider from https://www.khanacademy.org/computer-programming/i/4907647067357184
var Slider=function(x,y,w,min,max,title,dflt) {
    this.x=x;
    this.y=y;
    this.w=w;
    this.min=min;
    this.max=max;
    this.sliderW=20;
    this.sliderX=x+map(dflt,min,max,0,w);
    this.sliderY=y-this.sliderW/4;
    this.title=title;
    sliders.push(this);
};
Slider.prototype.mouseOver=function() {
    if(mouseX>this.sliderX &&mouseX<this.sliderX+this.sliderW&&mouseY>this.sliderY&&mouseY<this.sliderY+this.sliderW||this.moving) {
        cursor('POINTER');
        this.sliderW+=1;  
        this.sliderY=this.y-this.sliderW/3;
    }else{
        this.sliderW-=1;    
        this.sliderY=this.y-this.sliderW/4;
    }
};
Slider.prototype.draw= function() {
    noStroke();
    fill(200,200,230);
    rect(this.x,this.y,this.w+19,10);
    fill(250,180,200);
    rect(this.sliderX,this.sliderY,this.sliderW,this.sliderW);
    fill(0, 0, 0);
    this.value=map(this.sliderX-this.x,0,this.w,this.min,this.max);
    textAlign(CENTER,CENTER);
    text(this.title, this.x+this.w/2,this.y-15);
    text(this.value.toFixed(2), this.sliderX+this.sliderW/2, this.y+4);
};
Slider.prototype.update=function() {
    if(this.moving) {
        this.sliderX=mouseX-this.sliderW/2;     
    }
    this.sliderW=constrain(this.sliderW, 20, 25);
    this.sliderX=constrain(this.sliderX,this.x,this.x+this.w);
    this.mouseOver();
    this.draw();
};
mousePressed=function() {
    for(var i=0; i<sliders.length; i++) {
    if(mouseX>sliders[i].sliderX &&mouseX<sliders[i].sliderX+sliders[i].sliderW&&mouseY>sliders[i].sliderY&&mouseY<sliders[i].sliderY+sliders[i].sliderW) {
        sliders[i].moving=true;
    }
    }
};
mouseReleased=function() {
    for(var i=0; i<sliders.length; i++) {
    if(sliders[i].moving) {
        sliders[i].moving=false;
    }
    }
};

function combineNoiseAndFactor(n,factor,y){
    n *= factor;
    if(n > 0){n *= 4;}
    n += -0.703125;
    n = constrain(n,-64,64);
    n += 0.078125;
    n *= constrain(map(y,240,256,1,0),0,1);
    n += -0.078125 + -0.1171875;
    n *= constrain(map(y,-64,-40,0,1),0,1);
    n += 0.1171875;
    return n;
}
function maxYForFactor(x,factor){
    let y;
    for(y = 200; y>0; y-=10){
        if(combineNoiseAndFactor(noise(x,y),factor,y)>0.1){
            y += 10;
            break;
        }
    }
    for(let y2 = 0; y2<10; y2++, y--){
        if(combineNoiseAndFactor(noise(x,y),factor,y)>0.1){
            return y;
        }
    }
}

let sliderC = new Slider(10,290,360,-1,1,"Continentalness",0.2);
let sliderE = new Slider(10,330,360,-1,1,"Erosion",0.18);
let sliderW = new Slider(10,370,360,-1,1,"Weirdness",0.5);
sliderC.update();
sliderE.update();
sliderW.update();
let prevValues;
let cache = [];
let values = [];

let mouseI = null;
mouseMoved = function(){
    mouseI = round(mouseX/10);
};
mouseOut = function(){
    mouseI = null;
};

draw = function() {
    background(255);
    let curValues = sliderC.value+","+sliderE.value+","+sliderW.value;
    if(prevValues !== curValues){
        prevValues = curValues;
        noFill();
        
        let ci = 0;
        for(let i=0;i<=400;i+=10){
            const offset = getSplineLayer(splineData.offset,sliderC.value,sliderE.value,map(i,0,400,-1,1),sliderW.value);
            const factor = getSplineLayer(splineData.factor,sliderC.value,sliderE.value,map(i,0,400,-1,1),sliderW.value);
            const jaggedness = getSplineLayer(splineData.jaggedness,sliderC.value,sliderE.value,map(i,0,400,-1,1),sliderW.value);
            
            cache[ci++] = map(values[ci-1] = offset,-1,1,400,0);
            cache[ci++] = map(values[ci-1] = factor,-10,10,400,0);
            cache[ci++] = map(values[ci-1] = jaggedness,-1,1,400,0);
            cache[ci++] = map(values[ci-1] = offset + 1/factor/4,-1,1,400,0);
            values[ci-1] = values[ci-1]*128+64;//map(values[ci-1],-0.22+0.1875,-0.12+0.1875,39,52);
        }
    }
    for(let i=0, x=0; i<cache.length; i+=4, x+=10){
        stroke(255,0,0);
        line(x,cache[i],x-10,cache[i-4]);
        stroke(0,0,255);
        line(x,cache[i+1],x-10,cache[i+1-4]);
        stroke(138, 138, 138);
        line(x,cache[i+2],x-10,cache[i+2-4]);
        stroke(0,180,0);
        line(x,cache[i+3],x-10,cache[i+3-4]);
    }
    
    if(mouseI !== null){
        stroke(0);
        line(mouseI*10,0,mouseI*10,400);
        textSize(14);
        if(mouseI<20){
            textAlign(LEFT);
        }else{
            textAlign(RIGHT);
        }
        fill(255,0,0);
        text("Offset "+(values[mouseI*4]||0).toFixed(2),mouseI*10,max(cache[mouseI*4],10));
        fill(0,0,255);
        text("Factor "+(values[mouseI*4+1]||0).toFixed(2),mouseI*10,max(cache[mouseI*4+1],15));
        fill(138, 138, 138);
        text("Jaggedness "+(values[mouseI*4+2]||0).toFixed(2),mouseI*10,max(cache[mouseI*4+2],20));
        fill(0,180,0);
        text("height "+(values[mouseI*4+3]||0).toFixed(2),mouseI*10,max(cache[mouseI*4+3],35));
    }
    
    const ridges = (Math.abs(Math.abs(sliderW.value)-0.666666667)-0.333333333)*-3;
    let x=map(ridges,-1,1,0,400);
    line(x,0,x,height);
    
    textSize(14);
    sliderC.update();
    sliderE.update();
    sliderW.update();
    textSize(20);
    text("â€“      <----- Ridges ----->      +",200,20);
    textSize(14);
    text(round(this.__frameRate),30,10);
};
